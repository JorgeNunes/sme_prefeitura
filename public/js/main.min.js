$(document).ready(function(){
    

    $('.delete-cliente').on('click', function(e) {
        e.preventDefault();
        
        $('[data-value-cliente]').val($(this).attr('data-cliente'));
    });
    
    setTimeout(function(){
        $('[data-alert]').slideUp(1000);
    }, 4000);
    
    
    $('#dt_nascimento_aluno').focusout(function(e){
        
        var parametro = $('#dt_nascimento_aluno').val().replace("/", "-");
        parametro = parametro.replace("/", "-");
        
		$.getJSON('/calculo-fase-escolar/'+parametro, function (dados){
		    
		   if (dados.length > 0){ 	
			  var option;
			  var verificador;
              var nome;
			  $.each(dados, function(i, obj){
				  option = '<option value="'+ obj.id_fase_escola+'">'+obj.nm_fase_escola+'</option>';
				  verificador = obj.id_fase_escola;
                  nome = obj.nm_fase_escola;
			  });
			  
			  if(verificador === 6 || verificador === 7){
			      infoAlert("Essa vaga precisa ser preenchida imediatamente no "+nome);
			      $('#dt_nascimento_aluno').val('');
			  }else{
			      $('#id_fase_escola').html(option).show();
			  }
		   }
		});
	});
	
	$('input:text[id=cd_cpf_mae]').focusout(function(e){
	    if(validarCpf($('#cd_cpf_mae').val()) == false){
            infoAlert("AVISO!", "CPF INVÁLIDO!");
            $('#cd_cpf_mae').val('');
        }
    });
    
    $('input:text[id=cd_cpf_responsavel]').focusout(function(e){
	    if(validarCpf($('#cd_cpf_responsavel').val()) == false){
            infoAlert("AVISO!", "CPF INVÁLIDO!");
            $('#cd_cpf_responsavel').val('');
        }
    });
    
    $('input:text[id=nm_responsavel]').focusout(function(e){
        if(validarNome($('#nm_responsavel').val()) == false){
            infoAlert("AVISO!", "DIGITE O NOME COMPLETO SEM ABREVIAÇÕES!");
            $('#nm_responsavel').val('');
        }
    });
    
    $('input:text[id=nm_aluno]').focusout(function(e){
        if(validarNome($('#nm_aluno').val()) == false){
            infoAlert("AVISO!", "DIGITE O NOME COMPLETO SEM ABREVIAÇÕES!");
            $('#nm_aluno').val('');
        }
    });
    
    $('input:text[id=nm_mae]').focusout(function(e){
        if(validarNome($('#nm_mae').val()) == false){
            infoAlert("AVISO!", "DIGITE O NOME COMPLETO SEM ABREVIAÇÕES!");
            $('#nm_mae').val('');
        }
    });
    
    $('input:text[id=nm_rua]').focusout(function(e){
        if(validarNome($('#nm_rua').val()) == false){
            infoAlert("AVISO!", "DIGITE O NOME DA RUA SEM ABREVIAÇÕES!");
            $('#nm_rua').val('');
        }
    });
    
    $('input:text[id=nm_bairro]').focusout(function(e){
        if(validarNome($('#nm_bairro').val()) == false){
            infoAlert("AVISO!", "DIGITE O NOME DO BAIRRO SEM ABREVIAÇÕES!");
            $('#nm_bairro').val('');
        }
    });
});

function validarNome(parametro) {
    parametro = parametro.toUpperCase();
    var array = parametro.split(" ");
    var verifyName = ["DA", "DE", "DO", "DU"];
    var verificador = false;
    
    if(parametro == ""){
        return true;
    }
    
    for (var i = 0; i < array.length; i++) {
        if(array[i].length < 3){
            verificador = false;
            for (var a = 0; a < verifyName.length; a++) {
                if(verifyName[a].localeCompare(array[i]) == 0){
                    verificador = true;
                } 
            }
        }else{
            verificador = true;
        }
        
    }
    
    if(parametro.indexOf(".") >= 0){
        verificador = false;
    } 
    
    return verificador;        
}


function validarCpf(parametro) {
    var strCPF = parametro;
    var Soma;
    var Resto;
    
    if(parametro == ""){
        return true;
    }
    
    Soma = 0;
    if (strCPF == "00000000000"){
        return false;
    } 
    
    for (i=1; i<=9; i++) Soma = Soma + parseInt(strCPF.substring(i-1, i)) * (11 - i);
    Resto = (Soma * 10) % 11;
    
    if ((Resto == 10) || (Resto == 11))  Resto = 0;
    if (Resto != parseInt(strCPF.substring(9, 10)) ){
        return false;
    } 
    
    Soma = 0;
    for (i = 1; i <= 10; i++) Soma = Soma + parseInt(strCPF.substring(i-1, i)) * (12 - i);
    Resto = (Soma * 10) % 11;
    
    if ((Resto == 10) || (Resto == 11))  Resto = 0;
    if (Resto != parseInt(strCPF.substring(10, 11) ) ){
        return false;
    } 
    return true;
}








